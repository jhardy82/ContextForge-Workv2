# Tooling & MCP Capabilities Discovery — Conversational Agent Report (2025-08-13)

Generated by: GitHub Copilot
Workspace: c:\Users\james.e.hardy\OneDrive - Avanade\PowerShell Projects
Timestamp: 2025-08-13T00:00:00Z

---

## How I built this report
- Source inspection: repo docs and reference files (paths cited inline)
- Known tool registry: current agent tool catalog (core + MCP)
- Evidence-first: embedded excerpts and file paths; commands listed where
  applicable
- Unknowns marked as [UNKNOWN] with suggested probes

---

## Copilot Tooling — What I have and how it works

### Inventory (names, purpose, where spotted)
- Core file/workspace tools (Available):
  - create_file, read_file, apply_patch, insert_edit_into_file, list_dir,
    file_search, grep_search, semantic_search
  - Evidence: docs/reference/Agent-Tool-Inventory.md (Tool Categories, Core
    GitHub Copilot Tools) — Observed 2025-08-13
- Terminal/task tools (Available):
  - run_in_terminal, get_terminal_output, get_terminal_last_command,
    get_terminal_selection, run_task, create_and_run_task, get_task_output
  - Evidence: docs/reference/Agent-Tool-Inventory.md (Terminal Operations,
    Task Management); docs/reference/COMPLETE-Tool-Testing-119-Tools.md
    (tested results) — Observed 2025-08-13
- Notebook tools (Available):
  - create_new_jupyter_notebook, edit_notebook_file, run_notebook_cell,
    notebook_list_packages, notebook_install_packages,
    copilot_getNotebookSummary, read_notebook_cell_output
  - Evidence: Agent-Tool-Inventory.md (Notebook Operations) — Observed
    2025-08-13
- VS Code API/Extensions (Available):
  - get_vscode_api, install_extension, vscode_searchExtensions_internal
  - Evidence: Agent-Tool-Inventory.md (Extensions),
    COMPLETE-Tool-Testing-119-Tools.md (tested) — Observed 2025-08-13
- Python env tools (Available):
  - configure_python_environment, get_python_environment_details,
    get_python_executable_details, install_python_packages
  - Evidence: Agent-Tool-Inventory.md (Python Environment);
    COMPLETE-Tool-Testing-119-Tools.md — Observed 2025-08-13
- MCP tools (Available, mixed readiness):
  - Microsoft Docs: mcp_microsoft_doc_microsoft_docs_search,
    mcp_microsoft_doc_microsoft_docs_fetch
  - Pylance: mcp_pylance_mcp_s_pylanceDocuments,
    mcp_pylance_mcp_s_pylanceFileSyntaxErrors,
    mcp_pylance_mcp_s_pylanceImports, ...
  - GitHub MCP: mcp_github_*
  - Azure MCP: mcp_azure-mcp-ser_* (az/azd/azqr/etc.)
  - Evidence: docs/copilot-mcp-summary.yaml; docs/Agent-Execution-Environment.md;
    docs/reference/Agent-Tool-Inventory.md — Observed 2025-08-13

### How I call them (mechanism)
- Function-style tool invocation with typed schemas; composite “parallel”
  execution available for independent read-only calls.
- Evidence: docs/reference/Agent-Tool-Inventory.md (Tool Access Patterns,
  Direct Invocation/MCP); analysis/Complete-Tool-Capability-Assessment.ipynb
  (parallel tests); COMPLETE-Tool-Testing-119-Tools.md (categories tested) —
  Observed 2025-08-13

### Schemas (inputs/outputs/required/defaults)
- Core examples:
  - run_in_terminal: command (string, required), explanation (string,
    required), isBackground (bool, required); returns terminal id/output.
  - create_file: filePath (abs), content (string); returns file created.
  - apply_patch: V4A diff in single patch block.
  - Evidence: docs/reference/Agent-Tool-Inventory.md (tables);
    COMPLETE-Tool-Testing-119-Tools.md (per-tool sections) — Observed
    2025-08-13
- MCP examples:
  - mcp_microsoft_doc_microsoft_docs_search: query (required) -> array chunks
    (title, url, excerpt)
  - mcp_microsoft_doc_microsoft_docs_fetch: url (microsoft.com) -> full
    markdown
  - mcp_pylance_mcp_s_pylanceFileSyntaxErrors: fileUri, workspaceRoot -> error
    list
  - Evidence: docs/copilot-mcp-summary.yaml (parameters/returns);
    Agent-Execution-Environment.md (schemas section) — Observed 2025-08-13

### Where they run
- Core tools: inside VS Code agent runtime against current workspace; terminal
  commands run in user shell (PowerShell 5.1 on Windows here).
- MCP: remote servers or local language services (e.g., Pylance) via MCP
  transport; Azure endpoints route to CLI.
- Evidence: Agent-Execution-Environment.md (PowerShell Execution Environment,
  MCP Endpoints); docs/copilot-mcp-summary.yaml (endpoint scopes) — Observed
  2025-08-13

### Protections (auth/roles)
- GitHub MCP: requires valid GitHub credentials; may require Docker depending on
  transport.
- Azure MCP: Azure CLI credential flow; rate limits apply.
- Microsoft Docs MCP: none for search/fetch; standard throttling.
- Pylance MCP: VS Code workspace context; Python env requirements.
- Evidence: docs/reference/P018-COMPLETION-SUMMARY.md (Security and
  Compliance); docs/reference/HONEST-ASSESSMENT-P018-ToolVerification.md (auth
  reality)

### Logging of tool runs
- JSONL-first logging pattern in repo; quality tooling also emits artifacts;
  terminal outputs captured via get_terminal_output when used.
- Evidence: docs/copilot-mcp-summary.yaml (logs_first: primary_format jsonl);
  logs/ directory structure; AAR/*.jsonl

---

## MCP Capabilities — What I know and can see

### MCP libraries/implementation
- Implementation is agent-native; endpoints exposed as tool functions. Specific
  library details: [UNKNOWN]
- Suggested probe: Inspect runtime MCP client library version; check extension
  manifests.

### Discoverable MCP servers/endpoints
- Microsoft Docs:
  - Endpoints: microsoft_docs_search, microsoft_docs_fetch
  - Auth: none
  - Evidence: docs/Agent-Execution-Environment.md (MCP Endpoints); docs/copilot-mcp-summary.yaml (mcp_endpoints.microsoft_documentation)
- Pylance:
  - Endpoints: pylanceDocuments, pylanceFileSyntaxErrors, pylanceImports, pylanceWorkspaceRoots, etc.
  - Auth: VS Code workspace; Python env
  - Evidence: docs/copilot-mcp-summary.yaml (python_language_services); Agent-Tool-Inventory.md
- Azure (CLI-routed):
  - Endpoints: extension_az, extension_azd, extension_azqr, subscription,
    group, storage, sql, cosmos, keyvault, monitor, aks, grafana, postgres,
    redis, search, loadtesting, foundry, etc.
  - Auth: Azure CLI credential
  - Evidence: docs/copilot-mcp-summary.yaml (azure_services);
    Agent-Execution-Environment.md (Azure MCP Server Collection)
- GitHub:
  - Endpoints: mcp_github_* (create_repo, issues, search, etc.), some Docker-dependent
  - Auth: GitHub token
  - Evidence: docs/reference/Agent-Tool-Inventory.md; HONEST-ASSESSMENT-P018-ToolVerification.md

### MCP tool list with schema highlights
- See docs/copilot-mcp-summary.yaml (parameters/returns per endpoint) and
  Agent-Execution-Environment.md (schema snippets). Key examples included above.

### MCP security and logging
- Security: Provider-specific (GitHub tokens, Azure CLI). No plaintext secrets
  policy documented in repo.
- Logging: JSONL primary; AAR for significant ops; validation artifacts
  captured in build/artifacts and logs/.
- Evidence: .github/copilot-instructions.md (Secure Credential Handling);
  docs/copilot-mcp-summary.yaml (logging, trust-but-verify)

### MCP performance model
- Microsoft Docs: moderate (3–5s typical per COMPLETE-Tool-Testing-119-Tools.md)
- Pylance: variable; known hangs on pylanceWorkspaceRoots in this workspace.
- Azure: variable; network/CLI dependent; retries recommended.
- Evidence: COMPLETE-Tool-Testing-119-Tools.md (performance notes), analysis
  notebooks.

---

## Cross‑Cutting Findings

- Gaps vs modernization plan:
  - Some MCP GitHub endpoints untested and may need Docker/auth; Pylance workspace endpoints have hanging risk.
  - Suggest explicit timeouts and skip lists in harness; focus on Microsoft Docs MCP (working) and core tools.
- Adding tools/MCP servers:
  - New tools can be integrated via agent tool registry; MCP endpoints documented in copilot-mcp-summary.yaml—extendable.
  - Enterprise rules: Secure credential handling; no plaintext secrets; logging requirements (JSONL + AAR).
- Evidence: CRITICAL-CopilotInstructions-ToolVerification.md (MCP integration
  requirements); .github/copilot-instructions.md (security, logging),
  trust-but-verify-capabilities.yaml

---

## Evidence Index (paths, excerpts, timestamps)
- docs/reference/COMPLETE-Tool-Testing-119-Tools.md — Verified tool results;
  2025-08-06 to 2025-08-07 sessions (observed 2025-08-13)
- docs/reference/Agent-Tool-Inventory.md — Catalog, schemas, constraints;
  observed 2025-08-13
- docs/copilot-mcp-summary.yaml — MCP endpoints, schemas, logging standards;
  observed 2025-08-13
- docs/Agent-Execution-Environment.md — Execution env and MCP details;
  observed 2025-08-13
- docs/reference/HONEST-ASSESSMENT-P018-ToolVerification.md — Reality check on
  untested tools; observed 2025-08-13
- analysis/Complete-Tool-Capability-Assessment.ipynb — Real runs; timestamps
  embedded in notebook metadata; observed 2025-08-13

---

## Confidence & Risk
- Core tools: Confidence High; Risk Low (tested and stable)
- Microsoft Docs MCP: Confidence High; Risk Low (tested working)
- Pylance MCP: Confidence Low; Risk High (known hangs, workspace dependencies)
- GitHub MCP: Confidence Low; Risk Medium-High (auth/Docker dependencies)
- Azure MCP: Confidence Medium; Risk Medium (auth/CLI/network)

---

## Phase 2 Finalization — AAR (2025-08-13)

What worked
- Generic tasks for PSSA/Pester enabled targeted and broad runs with proper exit codes.
- Local-only JSONL logging baseline proved reliable and auditable.
- Focused quality chain accelerated end-to-end verification without cloud deps.

What didn’t work
- Some MCP/Pylance endpoints exhibited instability in this workspace.
- Initial attempt to create the chain script failed due to path resolution, corrected on retry.

Root causes
- Workspace scanning operations can hang language services; file additions need exact absolute paths.

Actionable improvements
- Add problem matchers for PSSA/Pester summaries in VS Code.
- Introduce timeouts and retries around MCP/Pylance calls; document skip list.
- Expand evidence harness to auto-copy artifacts to `logs/phase2/YYYYMMDD/`.

Phase 3 candidate objectives
- Implement richer MCP helpers and integrate with existing logging.
- Add performance metrics (event/sec, log size/1k events) harness across logging options.
- Formalize dependency graph and CI gates for quality chain.

## Pending Probes ([UNKNOWN] items)
- MCP client library/version used by this agent — Probe extension/runtime manifests.
- Actual runtime auth wiring for GitHub MCP — Attempt authenticated call or validate token presence.
- End-to-end Pylance WorkspaceRoots fix — Investigate kernel/state requirements or disable in harness.
- GitHub MCP in Docker — Validate runtime has Docker or provide fallback.

Suggested actions:
- Add timeout/retry wrappers to MCP calls in harness; maintain a skip list for known hangers.
- Prioritize Microsoft Docs MCP and core tools for immediate workflows.
- Stage authenticated tests for GitHub MCP where credentials are available.
- Gate Pylance workspace tools behind environment checks.

---

## Follow-Up Analysis — 2025-08-13

This follow-up anchors the initial discovery to Phase 1 realities, calls out gaps, and proposes
minimal, low-risk improvements. Timestamps reflect when each item was observed in this session.

### 1) Confirm & Anchor

- What matches Phase 1 handoff
  - Stable artifacts exist and are written by runners:
    - `build/artifacts/PSSA-Report.json`, `build/artifacts/PSSA-Findings.txt`,
      `build/artifacts/PSSA-Summary.txt` — produced by `build/Run-Phase1-Quality.ps1` using
      `build/Invoke-PSSA.ps1` (observed 2025-08-13)
    - `build/artifacts/Pester-Results-NUnit.xml` and `build/artifacts/Pester-Console.txt` —
      produced by `build/Run-PesterTests.ps1` (observed 2025-08-13)
  - Runners present and callable:
    - `build/Invoke-PSSA.ps1` and `build/Invoke-PSSA-Mode.ps1` (observed 2025-08-13)
    - `build/Run-PesterTests.ps1` (observed 2025-08-13)
    - `build/Check-QualityEnvironment.ps1` (observed 2025-08-13)
- Divergences or clarifications
  - MCP client library/version remains <UNKNOWN> because the agent abstracts MCP calls; no explicit
    package/version string was found in-repo during this session.
  - Code signing is de-scoped for Phase 1; treat as a future enhancement only.
  - Note: This Follow-Up uses <UNKNOWN> markers per your directive; earlier sections use
    [UNKNOWN] to satisfy markdownlint preferences.

### 2) Targeted Runner Support

- Current capability (confirmed from script parameters)
  - Pester: `build/Run-PesterTests.ps1` supports `[string[]]$Path` and file/glob targeting. It
    enumerates matching test files and runs them with progress and NUnit output.
    (observed 2025-08-13)
  - PSScriptAnalyzer: `build/Invoke-PSSA.ps1` supports `[string[]]$Path` and handles both files and
    folders with recursion and excludes; `build/Invoke-PSSA-Mode.ps1` proxies through with the same
    parameter. (observed 2025-08-13)
- Smallest improvements (optional, for consistency)
  - Add an alias `-TargetPath` to both scripts for a unified CLI while keeping `-Path` fully supported.
  - Consider `-ArtifactsDir` on `Run-PesterTests.ps1` to allow relocations without editing variables (see section 4).

Example usage

```powershell
# Focused PSSA on a single file (AutoFixable, fail build on findings)
PowerShell -ExecutionPolicy Bypass -File .\build\Invoke-PSSA-Mode.ps1 -Mode AutoFixable -Path .\SCCM\Get-WUScanSource.ps1 -ExitOnFindings

# Focused Pester on a pattern
PowerShell -ExecutionPolicy Bypass -File .\build\Run-PesterTests.ps1 -Path .\tests\SCCM.Get-WUScanSource*.Tests.ps1
```

### 3) Logging Standardization

- What exists now
  - Structured JSONL helper is present at `build/Logging-Common.ps1` (function `Write-StructuredLog`)
    with a default sink `logs/structured-log.jsonl`. (observed 2025-08-13)
  - Quality tools emit artifacts under `build/artifacts/`; AAR JSONL lives under `AAR/`. (observed 2025-08-13)
- Recommendation: single, unified runtime log
  - Path: `logs/runtime/tool-activity_YYYYMMDD.jsonl`
  - Shape: one JSON object per line with keys: `ts`, `agent_id`, `script|tool`, `action`,
    `params_redacted`, `run_id`, `duration_ms`, `status`, `artifact_paths`, `notes`.
  - Implementation: dot-source `build/Logging-Common.ps1` inside runners and call
    `Write-StructuredLog` at start/end and on errors.
- Heartbeat without disruption
  - Emit a heartbeat every 3–5 seconds in long loops using
    `Write-StructuredLog -EventType 'heartbeat' -Data @{ percent = <calc>; eta_s = <calc> }` and
    mirror the percent to `Write-Progress`.

### 4) Stable Artifact Integration

- Tools confirmed to read/write Phase 1 stable paths
  - `build/Run-Phase1-Quality.ps1` writes stable PSSA artifacts and ensures schema consistency. (observed 2025-08-13)
  - `build/Run-PesterTests.ps1` writes timestamped and stable copies for NUnit and console logs. (observed 2025-08-13)
  - `build/Invoke-PSSA.ps1` accepts `-OutputDirectory` and already targets `build/artifacts` by default. (observed 2025-08-13)
- Small alignment changes
  - Add optional `-ArtifactsDir` to `Run-PesterTests.ps1` (default to
    `Join-Path $PSScriptRoot 'artifacts'`) so all runners can be steered uniformly by automation/MCP.
  - Provide a tiny helper function (e.g., `Get-ArtifactPaths`) in `build/Logging-Common.ps1` or a
    new `build/Artifacts-Common.ps1` to centralize stable filenames.

### 5) MCP Tool Gap Mapping

- Targeted runs
  - Local scripts already support targeting; no new MCP methods strictly required. Optional: expose
    a simple MCP wrapper method like `mcp_quality_run_pester { path: string[] }` and
    `mcp_quality_run_pssa { path: string[], mode?: 'AutoFixable'|'All' }` for remote orchestration.
- Artifact query/management
  - Useful additions (status: <UNKNOWN> in current agent):
    - `mcp_artifacts_list` — discover stable/timestamped files under `build/artifacts` with metadata.
    - `mcp_artifact_read_json` — read/parse a JSON artifact with schema hint and safe depth.
    - `mcp_jsonl_append` — append an entry to the unified runtime JSONL.
  - Next probe: search agent tool catalog for any generic FS/artifact endpoints and add thin wrappers if missing.
- Logging/evidence standardization
  - A generic `mcp_log_event` would unify JSONL and AAR entries. Current availability: <UNKNOWN>.
    Next probe: inspect tool registry for a logging endpoint or add one backed by
    `Write-StructuredLog`.

### 6) Security & Policy Adjustments

- Code signing
  - Defer. Keep `build/Sign-Workspace.ps1` and `build/Get-CodeSigningStatus.ps1` for future phases only.
- Policy constraints for new methods/tools
  - PowerShell 5.1 baseline; do not import CM manually; support `-WhatIf`, `-Verbose`.
  - No plaintext secrets; use SecretManagement or secure env vars.
  - Logging First: prefer JSONL; emit AAR for significant failures.
  - Workspace First: reuse existing runners; wrappers should forward to these scripts rather than duplicating logic.

---

### Evidence Index (Follow-Up)

- `build/Run-PesterTests.ps1` — inspected parameters and behavior; observed 2025-08-13
- `build/Invoke-PSSA.ps1` — inspected parameters and output handling; observed 2025-08-13
- `build/Invoke-PSSA-Mode.ps1` — inspected proxy parameter passthrough; observed 2025-08-13
- `build/Run-Phase1-Quality.ps1` — confirmed stable artifact publication; observed 2025-08-13
- `build/Check-QualityEnvironment.ps1` — confirmed environment test entrypoint; observed 2025-08-13
- `build/Logging-Common.ps1` — confirmed JSONL helper and default sink; observed 2025-08-13

---

## Phase 2 Completion Summary — 2025-08-13

Implemented changes
- Logging-Common.ps1 enhanced:
  - Default JSONL sink at `logs/runtime/tool-activity_YYYYMMDD.jsonl`.
  - New `Write-Heartbeat` helper for periodic progress updates.
- Run-PesterTests.ps1 updated:
  - Added `-TargetPath` alias for `-Path`.
  - Optional `-ArtifactsDir` parameter.
  - Structured logging at run start/end and heartbeat per test file.
- Invoke-PSSA.ps1 updated:
  - Added `-TargetPath` alias for `-Path`.
  - Structured logging at run start/end.
- Evidence scaffolding created:
  - `docs/context/evidence/phase2/step-notes.md` for step-by-step notes.

Remaining gaps
- MCP wrappers for artifacts/logging remain <UNKNOWN> (to be added if needed):
  `mcp_artifacts_list`, `mcp_artifact_read_json`, `mcp_jsonl_append`, `mcp_log_event`.
- VS Code tasks for new targeted/ArtifactsDir parameters not yet added.

Recommendations for Phase 3
- Add thin MCP wrappers that call local scripts, preserving Workspace First.
- Wire `.vscode/tasks.json` to expose `-TargetPath`/`-ArtifactsDir` and to toggle heartbeat.
- Add post-run log validation to environment tests.

### AAR (After Action Review)
- What worked
  - Minimal changes enabled targeted runs and standardized logging without disrupting contracts.
  - Heartbeat + progress improves observability on long test enumerations.
- What didn’t
  - Inline HTML markers (<UNKNOWN>) conflict with markdownlint; kept where required by brief.
  - No MCP endpoints available yet for artifacts/logging, so wrappers deferred.
- Root causes
  - Lint rules vs. communication formatting; MCP abstraction hides client details.
- Actionable improvements
  - Provide lint exceptions or use bracketed placeholders where acceptable.
  - Implement minimal MCP wrappers, then validate in a controlled session.

Evidence (Phase 2)
- `build/Logging-Common.ps1` — updated; observed 2025-08-13
- `build/Run-PesterTests.ps1` — updated; observed 2025-08-13
- `build/Invoke-PSSA.ps1` — updated; observed 2025-08-13
- `docs/context/evidence/phase2/step-notes.md` — created; observed 2025-08-13

---

## Research Validation — 2025-08-13

Validated local environment and cmdlet availability on Windows PowerShell 5.1.

- PowerShell version: 5.1.26100.4652
- Pester: 5.7.1 (Import-Module -MinimumVersion 5.7.0 successful)
- PSScriptAnalyzer: 1.24.0
- Key cmdlets present:
  - Invoke-Pester, Invoke-ScriptAnalyzer, Get-ScriptAnalyzerRule, Write-Progress
  - Start-Transcript, Add-Content, ConvertTo-Json, Import-Module

Notes
- These versions satisfy Phase 2 assumptions (Pester 5.7.x, PSScriptAnalyzer enterprise rules).
- Follow-ups: expose -TargetPath and -ArtifactsDir via tasks; add MCP wrappers for artifacts/logging.

Official docs citations
- Invoke-ScriptAnalyzer: https://learn.microsoft.com/en-us/powershell/module/psscriptanalyzer/invoke-scriptanalyzer
- Get-ScriptAnalyzerRule: https://learn.microsoft.com/en-us/powershell/module/psscriptanalyzer/get-scriptanalyzerrule
- Write-Progress: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/write-progress
- Start-Transcript: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.host/start-transcript
- ConvertTo-Json: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/convertto-json
- Add-Content: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/add-content
- Import-Module: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/import-module
