================================================= test session starts =================================================
platform win32 -- Python 3.12.11, pytest-8.4.1, pluggy-1.6.0 -- C:\Users\James\Documents\Github\GHrepos\SCCMScripts\.venv\Scripts\python.exe
cachedir: .pytest_cache
hypothesis profile 'ci' -> database=None, deadline=None, print_blob=True, derandomize=True, suppress_health_check=(HealthCheck.too_slow,)
benchmark: 5.2.3 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
Using --randomly-seed=3707756726
rootdir: C:\Users\James\Documents\Github\GHrepos\SCCMScripts\TaskMan-v2\backend-api
configfile: pytest_repo.ini
plugins: anyio-4.10.0, Faker-39.0.0, hypothesis-6.138.3, asyncio-0.26.0, benchmark-5.2.3, console-scripts-1.4.1, cov-5.0.0, mock-3.15.1, randomly-3.16.0, timeout-2.4.0, xdist-3.8.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 10 items

tests/unit/db/repositories/test_project_repository.py::TestProjectRepositoryEdgeCases::test_get_by_owner PASSED  [ 10%]
tests/unit/db/repositories/test_project_repository.py::TestProjectRepositoryEdgeCases::test_create_project_method PASSED [ 20%]
tests/unit/db/repositories/test_project_repository.py::TestProjectRepositoryEdgeCases::test_update_project_method PASSED [ 30%]
tests/unit/db/repositories/test_project_repository.py::TestProjectRepositoryEdgeCases::test_search_filters_and_pagination PASSED [ 40%]
tests/unit/db/repositories/test_project_repository.py::TestProjectRepositoryEdgeCases::test_exists PASSED        [ 50%]
tests/unit/db/repositories/test_sprint_repository.py::TestSprintRepositoryEdgeCases::test_get_active_sprints PASSED [ 60%]
tests/unit/db/repositories/test_sprint_repository.py::TestSprintRepositoryEdgeCases::test_exists PASSED          [ 70%]
tests/unit/db/repositories/test_sprint_repository.py::TestSprintRepositoryEdgeCases::test_create_and_update_sprint_helpers PASSED [ 80%]
tests/unit/db/repositories/test_sprint_repository.py::TestSprintRepositoryEdgeCases::test_search_sprints FAILED  [ 90%]
tests/unit/db/repositories/test_sprint_repository.py::TestSprintRepositoryEdgeCases::test_get_by_project PASSED  [100%]

====================================================== FAILURES =======================================================
__________________________________ TestSprintRepositoryEdgeCases.test_search_sprints __________________________________

self = <test_sprint_repository.TestSprintRepositoryEdgeCases object at 0x00000186FF5E23C0>
async_session = <sqlalchemy.ext.asyncio.session.AsyncSession object at 0x00000186FF786AB0>
sample_project = <Project(id='P-TEST-001', name='Test Project', status='ProjectStatus.ACTIVE')>

    async def test_search_sprints(self, async_session: AsyncSession, sample_project):
        """Test search with filters."""
        repo = SprintRepository(async_session)
        async_session.add(sample_project)
    
        # 2 active for p1
        for i in range(2):
            s = Sprint(
                id=f"S-P1-A-{i}",
                name=f"S {i}",
                status=SprintStatus.ACTIVE,
                project_id=sample_project.id,
                cadence=SprintCadence.BIWEEKLY,
                start_date="2025-01-01",
                end_date="2025-01-14",
            )
            async_session.add(s)
    
        # 1 planning for p1
        s_plan = Sprint(
            id="S-P1-PLAN",
            name="Plan",
            status=SprintStatus.PLANNED,
            project_id=sample_project.id,
            cadence=SprintCadence.BIWEEKLY,
            start_date="2025-01-01",
            end_date="2025-01-14",
        )
        async_session.add(s_plan)
    
        # 1 active for p2 (phantom project id, assuming lazy checks or just insertion)
        s_p2 = Sprint(
            id="S-P2-A",
            name="P2 S",
            status=SprintStatus.ACTIVE,
            project_id="P-OTHER",
            cadence=SprintCadence.BIWEEKLY,
            start_date="2025-01-01",
            end_date="2025-01-14",
        )
        async_session.add(s_p2)
    
        await async_session.commit()
    
        # Search active + p1
        results, count = await repo.search(status=SprintStatus.ACTIVE, project_id=sample_project.id)
        assert count == 2
        assert len(results) == 2
    
        # Search planning
>       results_plan, _ = await repo.search(status=SprintStatus.PLANNING)
                                                   ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: type object 'SprintStatus' has no attribute 'PLANNING'. Did you mean: 'PLANNED'?

tests\unit\db\repositories\test_sprint_repository.py:140: AttributeError
------------------------------------------------ Captured stdout setup ------------------------------------------------
DEBUG: Creating engine...
DEBUG: Creating tables...
DEBUG: Yielding session...
---------------------------------------------- Captured stdout teardown -----------------------------------------------
DEBUG: Cleaning up...
=============================================== short test summary info ===============================================
FAILED tests/unit/db/repositories/test_sprint_repository.py::TestSprintRepositoryEdgeCases::test_search_sprints - AttributeError: type object 'SprintStatus' has no attribute 'PLANNING'. Did you mean: 'PLANNED'?
============================================= 1 failed, 9 passed in 0.67s =============================================
